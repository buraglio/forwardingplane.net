


    




<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/forwardingplane.net\/"
        },
        "articleSection" : "public",
        "name" : "NSR and ISSU on Juniper MX series with logical routers.",
        "headline" : "NSR and ISSU on Juniper MX series with logical routers.",
        "description" : "Lets just say, for instance, that you have an MX series router at somewhere on your network. Lets also say that said router is carved into more than just the main logical system. For the sake of this writing, lets say that your eBGP sessions are in the default logical system and your IGP is in the logical system, lets call it \x26ldquo;internal\x26rdquo;.\nJunOS has some wonderful mechanisms for keeping things running, one is called NSR (Non Stop Routing), the other is called ISSU (In Service Software Upgrade).",
        "inLanguage" : "en",
        "author" : "Nick Buragliotruenativemain",
        "creator" : "Nick Buragliotruenativemain",
        "publisher": "Nick Buragliotruenativemain",
        "accountablePerson" : "Nick Buragliotruenativemain",
        "copyrightHolder" : "Nick Buragliotruenativemain",
        "copyrightYear" : "2012",
        "datePublished": "2012-04-27 22:15:00 \x2b0000 \x2b0000",
        "dateModified" : "2012-04-27 22:15:00 \x2b0000 \x2b0000",
        "url" : "https:\/\/forwardingplane.net\/public\/post\/nsr-and-issu-on-juniper-mx-series-with-logical-routers\/",
        "wordCount" : "514",
        "keywords" : [ "Routing","Blog" ]
    }
    </script>
        
            <title>NSR and ISSU on Juniper MX series with logical routers. - ForwardingPlane.net</title>
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.58.3" />
        


        
        
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="NSR and ISSU on Juniper MX series with logical routers."/>
<meta name="twitter:description" content="Lets just say, for instance, that you have an MX series router at somewhere on your network. Lets also say that said router is carved into more than just the main logical system. For the sake of this writing, lets say that your eBGP sessions are in the default logical system and your IGP is in the logical system, lets call it &ldquo;internal&rdquo;.
JunOS has some wonderful mechanisms for keeping things running, one is called NSR (Non Stop Routing), the other is called ISSU (In Service Software Upgrade)."/>

        <meta property="og:title" content="NSR and ISSU on Juniper MX series with logical routers." />
<meta property="og:description" content="Lets just say, for instance, that you have an MX series router at somewhere on your network. Lets also say that said router is carved into more than just the main logical system. For the sake of this writing, lets say that your eBGP sessions are in the default logical system and your IGP is in the logical system, lets call it &ldquo;internal&rdquo;.
JunOS has some wonderful mechanisms for keeping things running, one is called NSR (Non Stop Routing), the other is called ISSU (In Service Software Upgrade)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forwardingplane.net/public/post/nsr-and-issu-on-juniper-mx-series-with-logical-routers/" />
<meta property="article:published_time" content="2012-04-27T22:15:00+00:00" />
<meta property="article:modified_time" content="2012-04-27T22:15:00+00:00" />

        <meta property="og:image" content="https://forwardingplane.net//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="NSR and ISSU on Juniper MX series with logical routers.">
<meta itemprop="description" content="Lets just say, for instance, that you have an MX series router at somewhere on your network. Lets also say that said router is carved into more than just the main logical system. For the sake of this writing, lets say that your eBGP sessions are in the default logical system and your IGP is in the logical system, lets call it &ldquo;internal&rdquo;.
JunOS has some wonderful mechanisms for keeping things running, one is called NSR (Non Stop Routing), the other is called ISSU (In Service Software Upgrade).">


<meta itemprop="datePublished" content="2012-04-27T22:15:00&#43;00:00" />
<meta itemprop="dateModified" content="2012-04-27T22:15:00&#43;00:00" />
<meta itemprop="wordCount" content="514">



<meta itemprop="keywords" content="Routing," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/main.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/add-on.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/academicons.min.css">
        

        


  
    


      
    </head>
    <body>

      
      <div id="wrapper">

    
<header id="header">
    
      <h1><a href="https://forwardingplane.net/"></a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="https://forwardingplane.net/post/">
                            <i class="post">&nbsp;</i>Posts
                    </a>
                </li>
            
                <li>
                    <a href="https://forwardingplane.net/about">
                            <i class="about">&nbsp;</i>about
                    </a>
                </li>
            
                <li>
                    <a href="https://forwardingplane.net/configuration-archive">
                            <i class="configuration-archive">&nbsp;</i>configuration-archive
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="https://forwardingplane.net/post/">
                            <h3>
                                <i class="post">&nbsp;</i>Posts
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://forwardingplane.net/about">
                            <h3>
                                <i class="about">&nbsp;</i>about
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://forwardingplane.net/configuration-archive">
                            <h3>
                                <i class="configuration-archive">&nbsp;</i>configuration-archive
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                

                
            </div>
        </section>

    
        
</section>

    
    <div id="main">
        <article class="post">
            
            <header>
    <div class="title">
        
            <h1><a href="https://forwardingplane.net/public/post/nsr-and-issu-on-juniper-mx-series-with-logical-routers/">NSR and ISSU on Juniper MX series with logical routers.</a></h1>
            
        
        
    </div>
</header>

            <div id="content">
                <p>Lets just say, for instance, that you have an MX series router at somewhere on your network. Lets also say that said router is carved into more than just the main logical system. For the sake of this writing, lets say that your eBGP sessions are in the default logical system and your IGP is in the logical system, lets call it &ldquo;internal&rdquo;.<br />
 JunOS has some wonderful mechanisms for keeping things running, one is called <a href="http://www.juniper.net/techpubs/en_US/junos9.5/information-products/topic-collections/swconfig-high-availability/nsr-overview.html">NSR</a> (Non Stop Routing), the other is called ISSU (In Service Software Upgrade). Typically these are really, really useful for performing non-impacting RE fail overs and software upgrades. Heck, I&rsquo;ve upgraded an MX960 in the middle of the day with no impact whatsoever. Thats right, I was that guy. It should be noted, that the MX960s in question didn&rsquo;t have any logical systems configured, which brings us to why I jotted this down into this web page.</p>

<p>Now, it&rsquo;s no secret that I am a fan of Juniper gear, and <a href="http://tech.buraglio.com/2010/12/junos-issu.html">I&rsquo;ve talked about this before</a>. But frankly, our MX series that have logical systems need upgraded so infrequently, I actually forgot about this little tidbit.  For whatever reason, it really surprised me during the last upgrade I did even though it makes perfect sense and I knew about it already. What that time comes that you need to upgrade JunOS, you&rsquo;ll have to keep one very important thing in mind:</p>

<p><strong>You can&rsquo;t take advantage of NSR in any logical system that isn&rsquo;t the default. </strong></p>

<p>Additionally, You can&rsquo;t choose the protocol or the logical system that NSR works on, it&rsquo;s on for all protocols on the default logical system if you enable it.</p>

<p>What does this actually mean?  Well, it means that if I do an ISSU (which you should still do even with logical systems), anything outside of my default logical system will re-converge.  If my eBGP sessions are outside, they&rsquo;ll drop and have to re-establish.  This isn&rsquo;t really that great of an idea if you peer with folks that keep dampen-happy.  Personally, I don;t like my BGP sessions to drop if they don&rsquo;t need to.  I&rsquo;d rather deal with an IGP adjacency change than a bunch of BGP sessions having to re-establish and churn through potentially a handful of full tables.</p>

<p>How do we get around the interruption this causes?  Well, the way we&rsquo;ve solved it is to have 2 MX480&rsquo;s connected redundantly.  That way, even if ISSU is going to cause an interruption due to a peering or adjacency change, the alternate path still exists.  Why do we have this setup?  Well, ideally we&rsquo;d have 4 MX480s and wouldn&rsquo;t need the logical systems, but hey, they&rsquo;re expensive.</p>

<p>So, what it the take away from this episode of &ldquo;as the packet turns&rdquo;?</p>

<p>If you must configure logical systems, know that NSR and ISSU doesn&rsquo;t really work as you may think in the non default.  Plan for some interruption, adjacency changes and or BGP sessions to drop.</p>

<p>Or buy more routers.</p>

<p>[[ This is a content summary only. Visit my website for full links, other content, and more! ]]</p>

            </div>
        </article>
    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
    
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
      </div>

      
    </div>
  </section>

  
  
  

  
  

  
  <section id="footer">
    
    <p class="copyright">
      
        Copyright (c) 2019, all rights reserved.
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js//highlight.min.js"></script>
        
        
        
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://forwardingplane.net/js/util.js"></script>
      <script src="https://forwardingplane.net/js/main.js"></script>
      <script src="https://forwardingplane.net/js/backToTop.js"></script>
    

    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

