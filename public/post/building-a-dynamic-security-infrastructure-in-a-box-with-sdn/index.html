<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/forwardingplane.net\/"
        },
        "articleSection" : "post",
        "name" : "Building a dynamic security infrastructure [in a box - with SDN]",
        "headline" : "Building a dynamic security infrastructure [in a box - with SDN]",
        "description" : "Years ago I wrote about building a secure network in a box. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then.",
        "inLanguage" : "en",
        "author" : "Nick Buragliotruenativemain",
        "creator" : "Nick Buragliotruenativemain",
        "publisher": "Nick Buragliotruenativemain",
        "accountablePerson" : "Nick Buragliotruenativemain",
        "copyrightHolder" : "Nick Buragliotruenativemain",
        "copyrightYear" : "2019",
        "datePublished": "2019-05-29 18:17:13 \x2b0000 \x2b0000",
        "dateModified" : "2019-05-29 18:17:13 \x2b0000 \x2b0000",
        "url" : "https:\/\/forwardingplane.net\/post\/building-a-dynamic-security-infrastructure-in-a-box-with-sdn\/",
        "wordCount" : "431",
        "keywords" : [ "Lab Time","OpenFlow","SDN","Security","Blog" ]
    }
    </script>
        
            
                <title>Building a dynamic security infrastructure [in a box - with SDN]</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.58.3" />
        


        
        
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building a dynamic security infrastructure [in a box - with SDN]"/>
<meta name="twitter:description" content="Years ago I wrote about building a secure network in a box. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then."/>

        <meta property="og:title" content="Building a dynamic security infrastructure [in a box - with SDN]" />
<meta property="og:description" content="Years ago I wrote about building a secure network in a box. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forwardingplane.net/post/building-a-dynamic-security-infrastructure-in-a-box-with-sdn/" />
<meta property="article:published_time" content="2019-05-29T18:17:13+00:00" />
<meta property="article:modified_time" content="2019-05-29T18:17:13+00:00" />

        <meta property="og:image" content="https://forwardingplane.net//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Building a dynamic security infrastructure [in a box - with SDN]">
<meta itemprop="description" content="Years ago I wrote about building a secure network in a box. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then.">


<meta itemprop="datePublished" content="2019-05-29T18:17:13&#43;00:00" />
<meta itemprop="dateModified" content="2019-05-29T18:17:13&#43;00:00" />
<meta itemprop="wordCount" content="431">



<meta itemprop="keywords" content="Lab Time,OpenFlow,SDN,Security," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/main.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/add-on.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/academicons.min.css">
        

        


  
    


      
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="https://forwardingplane.net/"></a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="https://forwardingplane.net/post/">
                            <i class="post">&nbsp;</i>Posts
                    </a>
                </li>
            
                <li>
                    <a href="https://forwardingplane.net/tags/">
                            <i class="tag">&nbsp;</i>Tags
                    </a>
                </li>
            
                <li>
                    <a href="https://forwardingplane.net/about">
                            <i class="about">&nbsp;</i>about
                    </a>
                </li>
            
                <li>
                    <a href="https://forwardingplane.net/resume">
                            <i class="resume">&nbsp;</i>resume
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="https://forwardingplane.net/post/">
                            <h3>
                                <i class="post">&nbsp;</i>Posts
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://forwardingplane.net/tags/">
                            <h3>
                                <i class="tag">&nbsp;</i>Tags
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://forwardingplane.net/about">
                            <h3>
                                <i class="about">&nbsp;</i>about
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://forwardingplane.net/resume">
                            <h3>
                                <i class="resume">&nbsp;</i>resume
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/packet-pushers-weekend-edition-no1/">Packet Pushers Weekend Edition Number 1</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-11-02'>
                                    November 2, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/">Posts</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-11-02'>
                                    November 2, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/elastiflow-template-vm/">ElastiFlow Template VM</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-09-08'>
                                    September 8, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/basic-automation-for-wisps-and-small-to-medium-isps/">Basic automation for WISPs and small to medium ISPs</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-07-29'>
                                    July 29, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/the-bgp-conundrum/">The BGP conundrum</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-06-30'>
                                    June 30, 2019</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            "/post/"
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f&amp;text=Building%20a%20dynamic%20security%20infrastructure%20%5bin%20a%20box%20-%20with%20SDN%5d&amp;via=" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f&amp;title=Building%20a%20dynamic%20security%20infrastructure%20%5bin%20a%20box%20-%20with%20SDN%5d" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f&amp;title=Building%20a%20dynamic%20security%20infrastructure%20%5bin%20a%20box%20-%20with%20SDN%5d" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f&amp;title=Building%20a%20dynamic%20security%20infrastructure%20%5bin%20a%20box%20-%20with%20SDN%5d" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f&amp;description=Building%20a%20dynamic%20security%20infrastructure%20%5bin%20a%20box%20-%20with%20SDN%5d" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-dynamic-security-infrastructure-in-a-box-with-sdn%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="https://forwardingplane.net/post/building-a-dynamic-security-infrastructure-in-a-box-with-sdn/">Building a dynamic security infrastructure [in a box - with SDN]</a></h1>
            
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2019-05-29'>
            May 29, 2019</time>
        <span class="author"></span>
        
        
    </div>
</header>


  

  

  <div id="content">
    <p>Years ago I wrote about building a <a href="https://www.forwardingplane.net/2013/07/building-a-secured-network-in-a-box/">secure network in a box</a>. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then. As I noted back in 2013 when I wrote that last post, OVS was a lot less well traveled and, frankly, there was not a reasonable controller that I could use in production for OpenFlow integration. I’ve since standardized on <a href="https://www.proxmox.com/en/">ProxMox</a> for my lab and production virtualization and have espoused on every available occasion the usefulness of the <a href="https://www.faucet.nz">Faucet SDN controller</a>. Both play fundamental roles in this project. This is significantly easier than I expected - primarily due to the use of faucet for controlling the OVS switch. It’s fairly straightforward, so I won’t go into the step by step details here since the projects have good install and support docs. Proxmox has support for OVS, so just install it using apt and create an OVS switch in the GUI interface. Faucet has <a href="https://docs.faucet.nz/en/latest/">amazingly complete documentation</a> and even a <a href="https://docs.faucet.nz/en/latest/installation.html#installing-on-raspberry-pi">raspberry pi image</a> (if you’re still thinking “OpenFlow is dead, isn’t it?”, have a listen to <a href="https://blog.ipspace.net/2019/04/using-faucet-to-build-sc18-network-with.html">this podcast</a> I did with Ivan Pepelnjak). From there, install a <a href="https://securityonion.net/">security option VM</a> (or any other tool you want to capture data with). Once you have the OVS switch, the controller, and the VM up and running getting data to it is as simple as issuing the comments to configure a controller. I my case the command was:```
sudo ovs-vsctl set-controller vmbr4 tcp:10.16.9.12:6653 tcp:10.16.9.12:6654</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-In my lab design the architecture was as such ![Faucet OVS Proxmox Security](https://www.forwardingplane.net/wp-content/uploads/2019/05/Faucet-OVS-Proxmox-Security.jpg "Faucet OVS Proxmox Security.jpg") The two switches on the right are physical and span all uplink data via two physical ports into my proxmox host. Everything else is done virtually in OVS. Once you have the controller setup, the data coming in, and the host listening, you can validate you have the correct controller, interfaces and ports in ovs.```" data-lang="In my lab design the architecture was as such ![Faucet OVS Proxmox Security](https://www.forwardingplane.net/wp-content/uploads/2019/05/Faucet-OVS-Proxmox-Security.jpg "Faucet OVS Proxmox Security.jpg") The two switches on the right are physical and span all uplink data via two physical ports into my proxmox host. Everything else is done virtually in OVS. Once you have the controller setup, the data coming in, and the host listening, you can validate you have the correct controller, interfaces and ports in ovs.```">root@pve1:~# ovs-vsctl show
75b4bc7f-4e00-45c2-8919-b043cbaf509d
Bridge &#34;vmbr4&#34;
Controller &#34;tcp:10.16.9.12:6654&#34;
Controller &#34;tcp:10.16.9.12:6653&#34;
is\_connected: true
Port &#34;enx00051ba65ece&#34;
Interface &#34;enx00051ba65ece&#34;
Port &#34;tap115i1&#34;
Interface &#34;tap115i1&#34;
Port &#34;vmbr4&#34;
Interface &#34;vmbr4&#34;
type: internal
Port &#34;eno2&#34;
Interface &#34;eno2&#34;
ovs\_version: “2.7.0&#34;</code></pre></div>
<p>Listing interfaces in OVS can be a helpful way to aid in building the faucet configuration```
root@pve1:~# ovs-vsctl &ndash;columns=ofport,name list interface
ofport : 65534
name : &ldquo;vmbr4&rdquo;</p>

<p>ofport              : 1
name : &ldquo;eno2&rdquo;</p>

<p>ofport              : 4
name : &ldquo;tap115i1&rdquo;</p>

<p>ofport              : 2
name : &ldquo;enx00051ba65ece&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-For spanning the data into the VM, the basic configuration within faucet looks like this and should reside in /etc/faucet/faucet.yaml. The real meat here is the mirror statement on port 4.```" data-lang="For spanning the data into the VM, the basic configuration within faucet looks like this and should reside in /etc/faucet/faucet.yaml. The real meat here is the mirror statement on port 4.```">dps:
    proxovs1:
        dp\_id: 0x51ba65ece
        hardware: &#34;Open vSwitch&#34;
        interfaces:
            65534:
                name: &#34;vmbr4&#34;
                description: &#34;ProxMox OVS vmbr4&#34;
                native\_vlan: servernet
            1:
                name: &#34;eno2&#34;
                description: &#34;Span from sw1&#34;
                native\_vlan: servernet
            2:
                name: &#34;enx00051ba65ece&#34;
                description: &#34;Span from sw2&#34;
                native\_vlan: servernet
            4:
                name: &#34;tap115i1&#34;
                description: &#34;ProxMox OVS vmbr4&#34;
                output\_only: True
                mirror: \[1,2\]</code></pre></div>
<p>This can be fairly easily adjusted to mirror all internal, east-west traffic in a virtualization farm.</p>

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="https://forwardingplane.net/tags/lab-time">Lab Time</a></li>
                
                
                <li><a class="article-category-link" href="https://forwardingplane.net/tags/openflow">OpenFlow</a></li>
                
                
                <li><a class="article-category-link" href="https://forwardingplane.net/tags/sdn">SDN</a></li>
                
                
                <li><a class="article-category-link" href="https://forwardingplane.net/tags/security">Security</a></li>
                
            
        
    </ul>
  </li>
</ul>

  </footer>

</article>


<ul class="actions pagination">
    
        <li><a href="https://forwardingplane.net/post/renaming-interfaces-under-linux/"
                class="button big previous">Renaming interfaces under linux</a></li>
    

    
        <li><a href="https://forwardingplane.net/post/the-bgp-conundrum/"
                class="button big next">The BGP conundrum</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
    
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/packet-pushers-weekend-edition-no1/">Packet Pushers Weekend Edition Number 1</a>
              </h3>
              
              <time class="published" datetime='2019-11-02'>
                November 2, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/">Posts</a>
              </h3>
              
              <time class="published" datetime='2019-11-02'>
                November 2, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/elastiflow-template-vm/">ElastiFlow Template VM</a>
              </h3>
              
              <time class="published" datetime='2019-09-08'>
                September 8, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/basic-automation-for-wisps-and-small-to-medium-isps/">Basic automation for WISPs and small to medium ISPs</a>
              </h3>
              
              <time class="published" datetime='2019-07-29'>
                July 29, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/the-bgp-conundrum/">The BGP conundrum</a>
              </h3>
              
              <time class="published" datetime='2019-06-30'>
                June 30, 2019
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            "/post/"
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  

  
  

  
  <section id="footer">
    
    <p class="copyright">
      
        Copyright (c) 2019, all rights reserved.
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js//highlight.min.js"></script>
        
        
        
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://forwardingplane.net/js/util.js"></script>
      <script src="https://forwardingplane.net/js/main.js"></script>
      <script src="https://forwardingplane.net/js/backToTop.js"></script>
    

    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

