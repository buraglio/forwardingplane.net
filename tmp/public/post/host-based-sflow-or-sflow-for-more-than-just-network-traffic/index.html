<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8" />
<meta name="author" content="Nick Buraglio" />
<meta name="description" content="A wealth of run on sentences, misspelled words, and grammatical errors related to Routing, Switching, Security, Strategy…." />
<meta name="keywords" content="blog, tech" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.58.3" />

<link rel="canonical" href="https://forwardingplane.net/post/host-based-sflow-or-sflow-for-more-than-just-network-traffic/">
<meta property="og:title" content="Host based sflow, or, sflow for more than just network traffic" />
<meta property="og:description" content="I&rsquo;m an awful sysadmin. Running services permanently isn&rsquo;t really my forte, I tend to lean more on the &ldquo;I&rsquo;ll get this proof of concept all working, prove that it works or doesn&rsquo;t, then roll it on for polishing by someone else&rdquo; kinda guy. That final 15% is something I&rsquo;m constantly working to refine and better myself at accomplishing. I&rsquo;m decent at debugging network services, and can be handy in a &ldquo;oh crap, it&rsquo;s down!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forwardingplane.net/post/host-based-sflow-or-sflow-for-more-than-just-network-traffic/" />
<meta property="article:published_time" content="2012-10-27T02:33:00+00:00" />
<meta property="article:modified_time" content="2012-10-27T02:33:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Host based sflow, or, sflow for more than just network traffic"/>
<meta name="twitter:description" content="I&rsquo;m an awful sysadmin. Running services permanently isn&rsquo;t really my forte, I tend to lean more on the &ldquo;I&rsquo;ll get this proof of concept all working, prove that it works or doesn&rsquo;t, then roll it on for polishing by someone else&rdquo; kinda guy. That final 15% is something I&rsquo;m constantly working to refine and better myself at accomplishing. I&rsquo;m decent at debugging network services, and can be handy in a &ldquo;oh crap, it&rsquo;s down!"/>


<meta itemprop="name" content="Host based sflow, or, sflow for more than just network traffic">
<meta itemprop="description" content="I&rsquo;m an awful sysadmin. Running services permanently isn&rsquo;t really my forte, I tend to lean more on the &ldquo;I&rsquo;ll get this proof of concept all working, prove that it works or doesn&rsquo;t, then roll it on for polishing by someone else&rdquo; kinda guy. That final 15% is something I&rsquo;m constantly working to refine and better myself at accomplishing. I&rsquo;m decent at debugging network services, and can be handy in a &ldquo;oh crap, it&rsquo;s down!">


<meta itemprop="datePublished" content="2012-10-27T02:33:00&#43;00:00" />
<meta itemprop="dateModified" content="2012-10-27T02:33:00&#43;00:00" />
<meta itemprop="wordCount" content="567">



<meta itemprop="keywords" content="Routing,UNIX," />


<link rel="stylesheet" href="https://forwardingplane.net/css/layout.css" />


<link rel="stylesheet" href="https://forwardingplane.net/css/default-dark.css" />




<title>


     Host based sflow, or, sflow for more than just network traffic 

</title>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="https://forwardingplane.net/">ForwardingPlane.net</a>
    </div> 

    
    
    <a class="nav-item" href="https://forwardingplane.net/post/"><div class="nav-item-title">Posts</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/tags/"><div class="nav-item-title">Tags</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/about"><div class="nav-item-title">about</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/configuration-archive"><div class="nav-item-title">configuration-archive</div></a>
    

  </nav>

  
<div class="social-links-header">

  
  <a href="mailto:my%20lastname%20at%20forwardingplane%20dot%20net"><div class="social-link">email</div></a>
  

  
  <a href="https://github.com/buraglio" target="_blank"><div class="social-link">gh</div></a>
  

  

  
  <a href="https://twitter.com/forwardingplane" target="_blank"><div class="social-link">twtr</div></a>
  

  
  <a href="https://www.linkedin.com/in/buraglio" target="_blank"><div class="social-link">in</div></a>
  

</div>


</div>


</header>


<article class="post">
    <h1 class="title"> Host based sflow, or, sflow for more than just network traffic </h1>
    <div class="content"> <p>I&rsquo;m an awful sysadmin.  Running services permanently isn&rsquo;t really my forte, I tend to lean more on the &ldquo;I&rsquo;ll get this proof of concept all working, prove that it works or doesn&rsquo;t, then roll it on for polishing by someone else&rdquo; kinda guy.  That final 15% is something I&rsquo;m constantly working to refine and better myself at accomplishing.   I&rsquo;m decent at debugging network services, and can be handy in a &ldquo;oh crap, it&rsquo;s down!&rdquo; scamerio, but day to day sysadmin&hellip;not really my speciality.<br />
I know enough programming to be dangerous and have enough experience to know how to set up or fix pretty much any OS with nearly any service on it.  15 years as a slash and burn Network Engineer will often lend itself to that.  That being said, I do enjoy playing with new options, software packages and and LOVE instrumentation.  Then I came across <a href="http://host-sflow.sourceforge.net/">this</a>.     <a href="http://blog.sflow.com/2012/01/host-sflow-distributed-agent.html">Host based sflow</a>&hellip;..for more than just network traffic.<br />
This idea is <strong>fantastic</strong>.<br />
<strong>Why</strong> did I never think of it?!?!?!?</p>

<p>Essentially it&rsquo;s <a href="http://en.wikipedia.org/wiki/SFlow">sflow</a>, a mechanism for monitoring network traffic, or thats at least how I thought of it being from the network side.  It&rsquo;s a lot like Netflow, but an open standard.  Many network devices support it for sampling transit routed packets.  It never occured to me to run it on hosts for other things like&hellip;..http hits, disk utilization&hellip;.memory usage.  This seems perfect for a cloud environment, or for a VM farm&hellip;.or anywhere you don&rsquo;t want to run snmpd or some weird commercial agent on a host.<br />
I already have an <a href="http://nfsen.sourceforge.net/">nfsen</a>/<a href="http://nfdump.sourceforge.net/">nfdump</a> instance, but it should work with any open source or commercial collector that supports sflow, which is a huge number.  Intermapper flow, inmon, there is a long list.</p>

<p>I had to see this work, since we had just discussed this type of monitoring in our new [broadband project of the year award winning] ISP, <a href="http://www.uc2b.net/">UC2B</a> that I am heavily involved in.<br />
So, on to the meat and potato..<br />
I grabbed the dpkg and installed it on my personal ubuntu server.</p>

<p><em>sudo dpkg -i hsflowd_1.22.2-1_x86_64.deb </em><br />
From there I needed to edit the conf file to point it my test flow collector, which happens to reside on the same box.  Use your favorite editor, I like vi personally but I&rsquo;ve been using it for 15 years. <br />
<em>sudo vi /etc/hsflowd.conf</em><br />
Change the following lines:</p>

<p><em>DNSSD = off</em></p>

<p>  <em>polling = 30</em><br />
<em>  sampling.http = 10</em><br />
<em>  sampling.memcache = 500</em></p>

<p><em> collector {</em></p>

<p><em>    ip = 127.0.0.1</em></p>

<p><em>     udpport = 6997</em></p>

<p><em>  }</em></p>

<p>Close out the file.  I chose to tweak a few of the defaults to see what it&rsquo;d yield.  </p>

<p>Now edit your nfsen.conf file</p>

<p><em>%sources = (</em><br />
<em>    &lsquo;home&rsquo;    =&gt; { &lsquo;port&rsquo; =&gt; &lsquo;6996&rsquo;, &lsquo;col&rsquo; =&gt; &lsquo;#0000ff&rsquo;, &lsquo;type&rsquo; =&gt; &lsquo;netflow&rsquo; },</em><br />
<em>    &lsquo;cupcake&rsquo;    =&gt; { &lsquo;port&rsquo; =&gt; &lsquo;6997&rsquo;, &lsquo;col&rsquo; =&gt; &lsquo;#0000ff&rsquo;, &lsquo;type&rsquo; =&gt; &lsquo;sflow&rsquo; },</em><br />
<em>);</em></p>

<p><em>sudo /services/netflow/bin/nfsen reconfig</em><br />
This should yield at the very least network data and provide a proof of concept. other services can be monitored by using the json options, but that&rsquo;s beyond the scope of this writing.  I could see a big win from this in a home brew cloud environment or a large VM farm since it can provide a very straightforward way to generate very useful data in a standard format that can be very simply monitored, queried and archived.    <br />
_<a href="http://gan.doubleclick.net/gan_click?lid=41000000028007181&amp;pid=UBM9786132095695&amp;adurl=http%3A%2F%2Fwww.cdsbooksdvds.com%2Fproduct.jhtm%3Fsku%3DUBM9786132095695&amp;usg=AFHzDLucmjq8niDqbnNmvyDzFPVpDnuqQQ&amp;pubid=590157">Paessler Router Traffic Grapher</a>_</p>

<p>[[ This is a content summary only. Visit my website for full links, other content, and more! ]]</p>
 </div>
    <footer class="post-footer">

  <div class="post-footer-data">
    
<div class="tags">
    
      <div class="tag">
        <a href="https://forwardingplane.net/tags/routing">#Routing</a>
      </div>
    
      <div class="tag">
        <a href="https://forwardingplane.net/tags/unix">#UNIX</a>
      </div>
    
</div>

    <div class="date"> 27 Oct 2012 </div>
  </div>

</footer>


  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "forwwardingplane" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</article>

  <footer>

  <div class="social-links-footer">

  
  <a href="mailto:my%20lastname%20at%20forwardingplane%20dot%20net"><div class="social-link">Email</div></a>
  

  
  <a href="https://github.com/buraglio" target="_blank"><div class="social-link">GitHub</div></a>
  

  

  
  <a href="https://twitter.com/forwardingplane" target="_blank"><div class="social-link">Twitter</div></a>
  

  
  <a href="https://www.linkedin.com/in/buraglio" target="_blank"><div class="social-link">LinkedIn</div></a>
  

  <div class="social-link">
  <a href="https://forwardingplane.net/index.xml" target="_blank">RSS</a>
  </div>

</div>


  <div class="copyright"> Copyright (c) 2019, all rights reserved. </div>

  <div class="poweredby">
    Powered by <a href="https://gohugo.io/">Hugo</a>.
  </div>

  </footer>

</div> 

</body>
</html>

