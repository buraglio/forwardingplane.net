<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8" />
<meta name="author" content="Nick Buraglio" />
<meta name="description" content="A wealth of run on sentences, misspelled words, and grammatical errors related to Routing, Switching, Security, Strategyâ€¦." />
<meta name="keywords" content="blog, tech" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.58.3" />

<link rel="canonical" href="https://forwardingplane.net/post/orig/2011-10-04-ftps-secure-ftp-from-the-command-line/">
<meta property="og:title" content="" />
<meta property="og:description" content="I have recently enabled Duo Security for many of my personal services, and I can&#8217;t recommend them enough. Personal two factor authentication is very useful and really powerful. It works on my iPhone and I have yet to run into any real issues&#8230;.except for one. I can&#8217;t use automation to scp or sftp anything anymore and keep my two factor auth working in a way I&#8217;m comfortable with.
Enter ftps. FTP is a terrible, yet immensely useful protocol." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forwardingplane.net/post/orig/2011-10-04-ftps-secure-ftp-from-the-command-line/" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="I have recently enabled Duo Security for many of my personal services, and I can&#8217;t recommend them enough. Personal two factor authentication is very useful and really powerful. It works on my iPhone and I have yet to run into any real issues&#8230;.except for one. I can&#8217;t use automation to scp or sftp anything anymore and keep my two factor auth working in a way I&#8217;m comfortable with.
Enter ftps. FTP is a terrible, yet immensely useful protocol."/>


<meta itemprop="name" content="">
<meta itemprop="description" content="I have recently enabled Duo Security for many of my personal services, and I can&#8217;t recommend them enough. Personal two factor authentication is very useful and really powerful. It works on my iPhone and I have yet to run into any real issues&#8230;.except for one. I can&#8217;t use automation to scp or sftp anything anymore and keep my two factor auth working in a way I&#8217;m comfortable with.
Enter ftps. FTP is a terrible, yet immensely useful protocol.">



<meta itemprop="wordCount" content="537">



<meta itemprop="keywords" content="" />


<link rel="stylesheet" href="https://forwardingplane.net/css/layout.css" />


<link rel="stylesheet" href="https://forwardingplane.net/css/default-dark.css" />




<title>


      

</title>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="https://forwardingplane.net/">ForwardingPlane.net</a>
    </div> 

    
    
    <a class="nav-item" href="https://forwardingplane.net/post/"><div class="nav-item-title">Posts</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/tags/"><div class="nav-item-title">Tags</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/about"><div class="nav-item-title">about</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/configuration-archive"><div class="nav-item-title">configuration-archive</div></a>
    

  </nav>

  
<div class="social-links-header">

  
  <a href="mailto:my%20lastname%20at%20forwardingplane%20dot%20net"><div class="social-link">email</div></a>
  

  
  <a href="https://github.com/buraglio" target="_blank"><div class="social-link">gh</div></a>
  

  

  
  <a href="https://twitter.com/forwardingplane" target="_blank"><div class="social-link">twtr</div></a>
  

  
  <a href="https://www.linkedin.com/in/buraglio" target="_blank"><div class="social-link">in</div></a>
  

</div>


</div>


</header>


<article class="post">
    <h1 class="title">  </h1>
    <div class="content"> <p>I have recently enabled <a href="http://www.duosecurity.com/">Duo Security</a> for many of my personal services, and I can&#8217;t recommend them enough. Personal <a href="http://en.wikipedia.org/wiki/Two-factor_authentication">two factor authentication</a> is very useful and really powerful. It works on my iPhone and I have yet to run into any real issues&#8230;.except for one. I can&#8217;t use automation to scp or sftp anything anymore and keep my two factor auth working in a way I&#8217;m comfortable with.</p>

<p>Enter <a href="http://en.wikipedia.org/wiki/Ftps">ftps</a>. FTP is a terrible, yet immensely useful protocol. I chose to use <a href="https://security.appspot.com/vsftpd.html">vsftp</a> under debian Linux with Implicit TLS/SSL, meaning there is no negotiation of protocol as with explicit ftps (or ftpes). It&#8217;s secure, or none.</p>

<p>Configuring this is pretty easy, but it does require some editing of the /etc/vsftpd.conf file. I added some stuff to make it do ftpes as such:</p>

<p>_ssl_enable=YES</p>

<p>allow_anon_ssl=NO</p>

<p>force_local_data_ssl=YES</p>

<p>force_local_logins_ssl=YES</p>

<p>rsa_cert_file=/etc/ssl/certs/vsftpd.pem</p>

<p>_</p>

<p>This and a few other tweaks that aren&#8217;t relevant here, make ftpes work on my machine.</p>

<p>Now, clients are another story. Most of the modern GUI based clients work. I know <a href="http://filezilla-project.org/">filezilla</a> works, and it&#8217;s free. The problem I have, is that I need to do this programmatically, via a script.</p>

<p>A bit of digging didn&#8217;t yield much, however, I did come across <a href="http://lftp.yar.ru/">lftp</a>. lftp is an extremely powerful command line ftp client that has a LOT of features, one of which is ftpes support. Now, the one problem with lftp is that it is extremely full featured. Like, overly featured. So much so, that it can be a bit daunting to make it do what you want, which in my case was pretty simple.</p>

<p>I wrote a simple script to make it do what I wanted, which was just to upload a file and move it around.</p>

<p>_</p>

<p>#!/bin/sh</p>

<p>_ <em>/usr/bin/lftp -u user,password remote.host.com</em> <em><eof cd="" www="" lcd="" mnt="" nas\_vol\_4="" files="" update="" put="" txt="" mv="" quit="" 0="" eof="" i=""></eof></em></p>

<div style="display: inline !important; ">
  <i><<eof<eof<eof<eof< div=""></eof<eof<eof<eof<></i><i><eof cd="" www="" lcd="" mnt="" nas_vol_4="" files="" update="" put="" txt="" mv="" quit="" 0="" eof="" i=""></p> 
  
  <div>
    cd data
  </div>
  

<p><div>
    lcd /mnt/NAS/files/updates
  </div></p>

<p><div>
    put updates.txt
  </div></p>

<p><div>
    mv updates.txt data.txt
  </div></p>

<p><div>
    quit 0
  </div></p>

<p><div>
    EOF
  </div></p>

<p><div>
  </div></p>

<p><p>
    </eof></i>
  </p></p>

<p><div>
    <eof cd="" www="" lcd="" mnt="" nas_vol_4="" files="" update="" put="" txt="" mv="" quit="" 0="" eof="" i="">This works fine, and since I&#8217;m using ftpes, it does all of the negotiation for me.</p></p>

<pre><code>&lt;p&gt;
  &lt;/eof&gt;
&lt;/p&gt;

&lt;div&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;i&gt;&lt;eof cd=&quot;&quot; www=&quot;&quot; lcd=&quot;&quot; mnt=&quot;&quot; nas_vol_4=&quot;&quot; files=&quot;&quot; update=&quot;&quot; put=&quot;&quot; txt=&quot;&quot; mv=&quot;&quot; quit=&quot;&quot; 0=&quot;&quot; eof=&quot;&quot; i=&quot;&quot;&gt;&lt;br /&gt; &lt;br /&gt;&lt;/eof&gt;&lt;/i&gt;
&lt;/div&gt;
</code></pre>

<p></div></div></p>

<p><div>
    [[ This is a content summary only. Visit my website for full links, other content, and more! ]]
  </div></p>

<p><div class="sharedaddy sd-sharing-enabled">
    <div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing">
      <h3 class="sd-title">
        Share this:
      </h3></p>

<pre><code>  &lt;div class=&quot;sd-content&quot;&gt;
    &lt;ul&gt;
      &lt;li class=&quot;share-twitter&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;sharing-twitter-28&quot; class=&quot;share-twitter sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=twitter&quot; target=&quot;_blank&quot; title=&quot;Click to share on Twitter&quot;&gt;&lt;span&gt;Twitter&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-email&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;&quot; class=&quot;share-email sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=email&quot; target=&quot;_blank&quot; title=&quot;Click to email this to a friend&quot;&gt;&lt;span&gt;Email&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-print&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;&quot; class=&quot;share-print sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/&quot; target=&quot;_blank&quot; title=&quot;Click to print&quot;&gt;&lt;span&gt;Print&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-linkedin&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;sharing-linkedin-28&quot; class=&quot;share-linkedin sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=linkedin&quot; target=&quot;_blank&quot; title=&quot;Click to share on LinkedIn&quot;&gt;&lt;span&gt;LinkedIn&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-facebook&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;sharing-facebook-28&quot; class=&quot;share-facebook sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=facebook&quot; target=&quot;_blank&quot; title=&quot;Click to share on Facebook&quot;&gt;&lt;span&gt;Facebook&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-reddit&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;&quot; class=&quot;share-reddit sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=reddit&quot; target=&quot;_blank&quot; title=&quot;Click to share on Reddit&quot;&gt;&lt;span&gt;Reddit&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-tumblr&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;&quot; class=&quot;share-tumblr sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=tumblr&quot; target=&quot;_blank&quot; title=&quot;Click to share on Tumblr&quot;&gt;&lt;span&gt;Tumblr&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-pinterest&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;sharing-pinterest-28&quot; class=&quot;share-pinterest sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=pinterest&quot; target=&quot;_blank&quot; title=&quot;Click to share on Pinterest&quot;&gt;&lt;span&gt;Pinterest&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-pocket&quot;&gt;
        &lt;a rel=&quot;nofollow noopener noreferrer&quot; data-shared=&quot;&quot; class=&quot;share-pocket sd-button share-icon&quot; href=&quot;http://www.forwardingplane.net/2011/10/ftps-secure-ftp-from-the-command-line/?share=pocket&quot; target=&quot;_blank&quot; title=&quot;Click to share on Pocket&quot;&gt;&lt;span&gt;Pocket&lt;/span&gt;&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class=&quot;share-end&quot;&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p></div></p>
 </div>
    <footer class="post-footer">

  <div class="post-footer-data">
    
<div class="tags">
    
</div>

    <div class="date"> 1 Jan 0001 </div>
  </div>

</footer>


  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "forwwardingplane" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</article>

  <footer>

  <div class="social-links-footer">

  
  <a href="mailto:my%20lastname%20at%20forwardingplane%20dot%20net"><div class="social-link">Email</div></a>
  

  
  <a href="https://github.com/buraglio" target="_blank"><div class="social-link">GitHub</div></a>
  

  

  
  <a href="https://twitter.com/forwardingplane" target="_blank"><div class="social-link">Twitter</div></a>
  

  
  <a href="https://www.linkedin.com/in/buraglio" target="_blank"><div class="social-link">LinkedIn</div></a>
  

  <div class="social-link">
  <a href="https://forwardingplane.net/index.xml" target="_blank">RSS</a>
  </div>

</div>


  <div class="copyright"> Copyright (c) 2019, all rights reserved. </div>

  <div class="poweredby">
    Powered by <a href="https://gohugo.io/">Hugo</a>.
  </div>

  </footer>

</div> 

</body>
</html>

