


    




<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/forwardingplane.net\/"
        },
        "articleSection" : "posts",
        "name" : "NIX4NetEng 6 DNS, ad-blocking, and quality of experience",
        "headline" : "NIX4NetEng 6 DNS, ad-blocking, and quality of experience",
        "description" : "The sixth [and arguably very overdue] installment of my NIX4NetEng series, this began as an overly complex diatribe about DNS. As it evolved, I realized that DNS is so complex and far reaching that it could never be contained in one meager post. DNS is a powerful tool. It has existed for so long that many that have never had the responsibility of running an authoritative or recursive resolver may take for granted the extensive reach of a tool so engrained in the fabric of the internet that it is frequently overlooked, much like a utility such as electricity or running water.",
        "inLanguage" : "en",
        "author" : "Nick Buragliotruenativemain",
        "creator" : "Nick Buragliotruenativemain",
        "publisher": "Nick Buragliotruenativemain",
        "accountablePerson" : "Nick Buragliotruenativemain",
        "copyrightHolder" : "Nick Buragliotruenativemain",
        "copyrightYear" : "2016",
        "datePublished": "2016-02-27 16:40:04 \x2b0000 \x2b0000",
        "dateModified" : "2016-02-27 16:40:04 \x2b0000 \x2b0000",
        "url" : "https:\/\/forwardingplane.net\/2016\/02\/nix4neteng-6-dns-ad-blocking-and-quality-of-experience\/",
        "wordCount" : "770",
        "keywords" : [ "NIX4NetEng","UNIX","Blog" ]
    }
    </script>
        
            <title>NIX4NetEng 6 DNS, ad-blocking, and quality of experience - ForwardingPlane.net</title>
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.58.3" />
        


        
        
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="NIX4NetEng 6 DNS, ad-blocking, and quality of experience"/>
<meta name="twitter:description" content="The sixth [and arguably very overdue] installment of my NIX4NetEng series, this began as an overly complex diatribe about DNS. As it evolved, I realized that DNS is so complex and far reaching that it could never be contained in one meager post. DNS is a powerful tool. It has existed for so long that many that have never had the responsibility of running an authoritative or recursive resolver may take for granted the extensive reach of a tool so engrained in the fabric of the internet that it is frequently overlooked, much like a utility such as electricity or running water."/>

        <meta property="og:title" content="NIX4NetEng 6 DNS, ad-blocking, and quality of experience" />
<meta property="og:description" content="The sixth [and arguably very overdue] installment of my NIX4NetEng series, this began as an overly complex diatribe about DNS. As it evolved, I realized that DNS is so complex and far reaching that it could never be contained in one meager post. DNS is a powerful tool. It has existed for so long that many that have never had the responsibility of running an authoritative or recursive resolver may take for granted the extensive reach of a tool so engrained in the fabric of the internet that it is frequently overlooked, much like a utility such as electricity or running water." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forwardingplane.net/2016/02/nix4neteng-6-dns-ad-blocking-and-quality-of-experience/" />
<meta property="article:published_time" content="2016-02-27T16:40:04+00:00" />
<meta property="article:modified_time" content="2016-02-27T16:40:04+00:00" />

        <meta property="og:image" content="https://forwardingplane.net//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="NIX4NetEng 6 DNS, ad-blocking, and quality of experience">
<meta itemprop="description" content="The sixth [and arguably very overdue] installment of my NIX4NetEng series, this began as an overly complex diatribe about DNS. As it evolved, I realized that DNS is so complex and far reaching that it could never be contained in one meager post. DNS is a powerful tool. It has existed for so long that many that have never had the responsibility of running an authoritative or recursive resolver may take for granted the extensive reach of a tool so engrained in the fabric of the internet that it is frequently overlooked, much like a utility such as electricity or running water.">


<meta itemprop="datePublished" content="2016-02-27T16:40:04&#43;00:00" />
<meta itemprop="dateModified" content="2016-02-27T16:40:04&#43;00:00" />
<meta itemprop="wordCount" content="770">



<meta itemprop="keywords" content="NIX4NetEng,UNIX," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/main.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/add-on.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/academicons.min.css">
        

        


  
    


      
    </head>
    <body>

      
      <div id="wrapper">

    
<header id="header">
    
      <h1><a href="https://forwardingplane.net/"></a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="https://forwardingplane.net/posts/">
                            <i class="posts">&nbsp;</i>Posts
                    </a>
                </li>
            
                <li>
                    <a href="https://forwardingplane.net/about">
                            <i class="about">&nbsp;</i>about
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="https://forwardingplane.net/posts/">
                            <h3>
                                <i class="posts">&nbsp;</i>Posts
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://forwardingplane.net/about">
                            <h3>
                                <i class="about">&nbsp;</i>about
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                

                
            </div>
        </section>

    
        
</section>

    
    <div id="main">
        <article class="post">
            
            <header>
    <div class="title">
        
            <h1><a href="https://forwardingplane.net/2016/02/nix4neteng-6-dns-ad-blocking-and-quality-of-experience/">NIX4NetEng 6 DNS, ad-blocking, and quality of experience</a></h1>
            
        
        
    </div>
</header>

            <div id="content">
                

<p>The sixth [and arguably very overdue] installment of my <a href="https://www.forwardingplane.net/?s=nix4neteng">NIX4NetEng</a> series, this began as an overly complex diatribe about <a href="https://en.wikipedia.org/wiki/Domain_Name_System">DNS</a>. As it evolved, I realized that DNS is so complex and far reaching that it could never be contained in one meager post. DNS is a powerful tool. It has existed for so long that many that have never had the responsibility of running an authoritative or recursive resolver may take for granted the extensive reach of a tool so engrained in the fabric of the internet that it is frequently overlooked, much like a utility such as electricity or running water. Over time DNS has been reviled as the weak link in the chain that is the internet and and revered as the binding agent that makes the internet as we know it function. As someone that has run service provider and large campus resolvers, both recursive and authoritative, my opinion is that it is both. In the old days, and even now, black hat players will often target resolvers to perform DNS poisioning and will employ techniques such as flux and double flux to obfuscate their bot herders. Content providers use DNS tricks and anycast DNS to steer eyeballs to the topologically closest resource. Wifi hotspots use DNS to capture and force users through a captive portal. As users at large surf the web, advertisers utilize DNS to deliver advertising. Google does this, Yahoo does it, Hulu and other streaming video services do it. It has also been known to deliver pretty nasty <a href="https://en.wikipedia.org/wiki/Malvertising">malware</a>. That&rsquo;s why when internet and security ninja <a href="http://blog.samoehlert.com/">Sam Oehlert</a> pointed me at this project called <a href="https://pi-hole.net/">pi-hole</a>, I knew that it would be a blog post. Pi-Hole is a recursive resolver based on the venerable <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> that actively blocks and logs ads. And it WORKS. The initial project was aimed at running this on a raspberry pi as a hardware based resolver for a small network. While this works well, it&rsquo;s really just a linux service that can be run as a <a href="https://hub.docker.com/r/diginc/pi-hole/">docker container</a> or a standard LXC container. I decided to set this up as a linux container on my <a href="https://www.proxmox.com/en/">proxmox</a> box. The install is as simple as running a single command and walking through some simple menus.</p>

<h2 id="curl-l-install-pi-hole-net-bash">curl -L install.pi-hole.net | bash</h2>

<p>The install is straightforward and allows for both IPv4 <strong>and</strong> IPv6 ad blocking, should your network support it (which is should!). Like any self funded opensource project, I have found a few caveats and hidden features with it:</p>

<ul>
<li>Scaling the web interface for a network that performs significant numbers of queries is hard. It seems to have a difficult time displaying from large log files. Perhaps they&rsquo;ll add something like a sqlite db to make this faster, the web interface seems to be updated frequently.</li>
<li>It&rsquo;s based on dnsmasq, so adding local hostnames for within your network is a trivial as adding them to the /etc/hosts file on the pihole device. I personally don not like to type IP addresses and my network has been dial stacked with IPv6 for more than a decade, so local DNS resolution is a requirement. I&rsquo;m not memorizing v6 addresses.</li>
<li>Again, it&rsquo;s based on dnsmasq, so the flexibility and features are pretty significant and are as simple as tweaking the config file once it&rsquo;s installed.</li>

<li><p>The query log is available. Security professionals are always interested in DNS query logs - they provide a monumental amount of useful information. With pihole, you have access to that in /etc/log/pihole.log. Here is a snippit of the log</p>

<pre><code>Feb 27 16:28:04 dnsmasq\[7620\]: /etc/pihole/gravity.list s.youtube.com is 10.209.209.10
Feb 27 16:28:04 dnsmasq\[7620\]: query\[AAAA\] pubads.g.doubleclick.net from 10.209.89.21
Feb 27 16:28:04 dnsmasq\[7620\]: /etc/pihole/gravity.list pubads.g.doubleclick.net is 2001:470:c03a:809::a
Feb 27 16:28:04 dnsmasq\[7620\]: query\[A\] pubads.g.doubleclick.net from 10.209.89.21
Feb 27 16:28:04 dnsmasq\[7620\]: /etc/pihole/gravity.list pubads.g.doubleclick.net is 10.209.209.10
Feb 27 16:28:04 dnsmasq\[7620\]: query\[A\] r2---sn-vgqs7nls.googlevideo.com from 10.209.89.21
Feb 27 16:28:04 dnsmasq\[7620\]: forwarded r2---sn-vgqs7nls.googlevideo.com to 75.75.76.76
Feb 27 16:28:04 dnsmasq\[7620\]: query\[AAAA\] r2---sn-vgqs7nls.googlevideo.com from 10.209.89.21
Feb 27 16:28:04 dnsmasq\[7620\]: forwarded r2---sn-vgqs7nls.googlevideo.com to 75.75.76.76
Feb 27 16:28:04 dnsmasq\[7620\]: query\[AAAA\] manifest.googlevideo.com from 10.209.89.21
Feb 27 16:28:04 dnsmasq\[7620\]: forwarded manifest.googlevideo.com to 75.75.76.76
Feb 27 16:28:04 dnsmasq\[7620\]: query\[A\] manifest.googlevideo.com from 10.209.89.21
Feb 27 16:28:04 dnsmasq\[7620\]: forwarded manifest.googlevideo.com to 75.75.76.76
</code></pre></li>

<li><p>It&rsquo;s easy to add or remove ad domains. Just edit /etc/pihole/gravity.list</p></li>
</ul>

<p>  <a href="https://vimeo.com/135965232">Pi-hole Explained</a> from <a href="https://vimeo.com/user40849716">Pi-hole</a> on <a href="https://vimeo.com">Vimeo</a>.   Completely ignoring the merit or unethical nature of blocking revenue generating advertisements (which I personally make a small amount of money on from on my <a href="https://www.youtube.com/buraglio">youtube channel</a>), this is a recommended project that exposes networking folks to unix, critical network services, as well as security. <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=3J2L3Z4DHW9UY">Throw them some beer or coffee money</a> if you find it useful. They&rsquo;ve earned it.</p>

            </div>
        </article>
    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
    
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
      </div>

      
    </div>
  </section>

  
  
  

  
  

  
  <section id="footer">
    
    <p class="copyright">
      
        Copyright (c) 2019, all rights reserved.
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js//highlight.min.js"></script>
        
        
        
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://forwardingplane.net/js/util.js"></script>
      <script src="https://forwardingplane.net/js/main.js"></script>
      <script src="https://forwardingplane.net/js/backToTop.js"></script>
    

    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

