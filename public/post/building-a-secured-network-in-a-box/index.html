<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/forwardingplane.net\/"
        },
        "articleSection" : "post",
        "name" : "Building a secured network in a box",
        "headline" : "Building a secured network in a box",
        "description" : "In many environments, the move to virtualization is a path well traveled. My home and lab networks are no exception to this and I\x26rsquo;m sure nearly everyone who reads these pages has at least been exposed to it in one way or another. I have played with nearly all of the virtualization platforms and am firmly in the camp that there will be a large segment of networking that will move to a virtualized platform especially in the data center and campus segments.",
        "inLanguage" : "en",
        "author" : "Nick Buragliotruenativemain",
        "creator" : "Nick Buragliotruenativemain",
        "publisher": "Nick Buragliotruenativemain",
        "accountablePerson" : "Nick Buragliotruenativemain",
        "copyrightHolder" : "Nick Buragliotruenativemain",
        "copyrightYear" : "2013",
        "datePublished": "2013-07-26 05:28:15 \x2b0000 \x2b0000",
        "dateModified" : "2013-07-26 05:28:15 \x2b0000 \x2b0000",
        "url" : "https:\/\/forwardingplane.net\/post\/building-a-secured-network-in-a-box\/",
        "wordCount" : "869",
        "keywords" : [ "Lab Time","Security","Virtualization","Blog" ]
    }
    </script>
        
            
                <title>Building a secured network in a box</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.58.3" />
        


        
        
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building a secured network in a box"/>
<meta name="twitter:description" content="In many environments, the move to virtualization is a path well traveled. My home and lab networks are no exception to this and I&rsquo;m sure nearly everyone who reads these pages has at least been exposed to it in one way or another. I have played with nearly all of the virtualization platforms and am firmly in the camp that there will be a large segment of networking that will move to a virtualized platform especially in the data center and campus segments."/>

        <meta property="og:title" content="Building a secured network in a box" />
<meta property="og:description" content="In many environments, the move to virtualization is a path well traveled. My home and lab networks are no exception to this and I&rsquo;m sure nearly everyone who reads these pages has at least been exposed to it in one way or another. I have played with nearly all of the virtualization platforms and am firmly in the camp that there will be a large segment of networking that will move to a virtualized platform especially in the data center and campus segments." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forwardingplane.net/post/building-a-secured-network-in-a-box/" />
<meta property="article:published_time" content="2013-07-26T05:28:15+00:00" />
<meta property="article:modified_time" content="2013-07-26T05:28:15+00:00" />

        <meta property="og:image" content="https://forwardingplane.net//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Building a secured network in a box">
<meta itemprop="description" content="In many environments, the move to virtualization is a path well traveled. My home and lab networks are no exception to this and I&rsquo;m sure nearly everyone who reads these pages has at least been exposed to it in one way or another. I have played with nearly all of the virtualization platforms and am firmly in the camp that there will be a large segment of networking that will move to a virtualized platform especially in the data center and campus segments.">


<meta itemprop="datePublished" content="2013-07-26T05:28:15&#43;00:00" />
<meta itemprop="dateModified" content="2013-07-26T05:28:15&#43;00:00" />
<meta itemprop="wordCount" content="869">



<meta itemprop="keywords" content="Lab Time,Security,Virtualization," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/main.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/add-on.css">
            <link rel="stylesheet" href="https://forwardingplane.net/css/academicons.min.css">
        

        


  
    


      
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="https://forwardingplane.net/"></a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="https://forwardingplane.net/post/">
                            <i class="post">&nbsp;</i>Posts
                    </a>
                </li>
            
                <li>
                    <a href="https://forwardingplane.net/about">
                            <i class="about">&nbsp;</i>about
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://forwardingplane.net/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="https://forwardingplane.net/post/">
                            <h3>
                                <i class="post">&nbsp;</i>Posts
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="https://forwardingplane.net/about">
                            <h3>
                                <i class="about">&nbsp;</i>about
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/packet-pushers-weekend-edition-no1/">Packet Pushers Weekend Edition Number 1</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-11-02'>
                                    November 2, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/">Posts</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-11-02'>
                                    November 2, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/elastiflow-template-vm/">ElastiFlow Template VM</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-09-08'>
                                    September 8, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/basic-automation-for-wisps-and-small-to-medium-isps/">Basic automation for WISPs and small to medium ISPs</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-07-29'>
                                    July 29, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://forwardingplane.net/post/the-bgp-conundrum/">The BGP conundrum</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-06-30'>
                                    June 30, 2019</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            "/post/"
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f&amp;text=Building%20a%20secured%20network%20in%20a%20box&amp;via=" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f&amp;title=Building%20a%20secured%20network%20in%20a%20box" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f&amp;title=Building%20a%20secured%20network%20in%20a%20box" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f&amp;title=Building%20a%20secured%20network%20in%20a%20box" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f&amp;description=Building%20a%20secured%20network%20in%20a%20box" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fforwardingplane.net%2fpost%2fbuilding-a-secured-network-in-a-box%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="https://forwardingplane.net/post/building-a-secured-network-in-a-box/">Building a secured network in a box</a></h1>
            
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2013-07-26'>
            July 26, 2013</time>
        <span class="author"></span>
        
        
    </div>
</header>


  

  

  <div id="content">
    <p>In many environments, the move to virtualization is a path well traveled.  My home and lab networks are no exception to this and I&rsquo;m sure nearly everyone who reads these pages has at least been exposed to it in one way or another.  I have played with nearly all of the virtualization platforms and am firmly in the camp that there will be a large segment of networking that will move to a virtualized platform especially in the data center and campus segments.  Virtualization of routing tables has existed for a long time, see <a href="http://en.wikipedia.org/wiki/Virtual_Routing_and_Forwarding">VRF-Lite  and MPLS VRF</a> as well as multi-tenancy technologies like Junipers logical systems so the concept, at some level, has existed in networking for quite some time. &ldquo;How is a small to medium sized environment going to take advantage of this and more interestingly, how can it be secured?&rdquo; <a href="http://www.forwardingplane.net/wp-content/uploads/2013/07/Red_onions.jpg"><img src="http://www.forwardingplane.net/wp-content/uploads/2013/07/Red_onions-1024x763.jpg" alt="Red_onions" /></a>This is a question I inadvertently found at least one answer to when building out my own network and testing a great little project called <a href="http://securityonion.blogspot.com/">security onion</a>.  I&rsquo;d seen and used this platform a bit in the past, but it had been at least a version ago and my exposure was pretty short. The problem now, though, was that everything I have in use other than a gigabit switch and a NAS is virtualized.  My firewall, my router, all of my dev and test boxes and all but one of my non-portable machines.  All VMs.  I&rsquo;d gone back and forth between VMware and KVM, and while I like KVM better, management of edge case or non-standard networking stuff wasn&rsquo;t as well documented and <a href="http://openvswitch.org/">OVS</a> either wasn&rsquo;t in the build of CentOS I was using or I didn&rsquo;t know about its inclusion yet, so I settled on VMware ESXi 5 for this particular box.  I needed to be able to span a port on a vswitch.  My hopes were not high, but I figured there may be an unsupported way. Interestingly enough, the VMWare operating system has a mechanism for makeshift &ldquo;spanning&rdquo; a port.  More correctly, it has a way to see &ldquo;all vlans&rdquo; on a given vswitch, and it&rsquo;s quite simple.  Essentially, you have to create a port group on vlan 4095 on the vswitch then set that port group to promiscuous mode. Add the vm NIC that you are going to use to monitor traffic to that port group.  <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1004099">From VMware site</a>: <a href="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWare-site.png"><img src="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWare-site.png" alt="VMWare-site" /></a> I was pleasanty surprised at how easy it was and was at the point of telling security onion to have interfaces on both of the vswitches in less than 15 minutes. Configuration, Networking, Properties, Security. VLAN 4095. Done.Here are a few screenshots of my VMware config following the steps laid out above. It&rsquo;s far more simple than I could have imagined.   <a href="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWAre-config-networking.png"><img src="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWAre-config-networking.png" alt="VMWAre-config-networking" /></a> <a href="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWare-SPAN-WAN1.png"><img src="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWare-SPAN-WAN1.png" alt="VMWare-SPAN-WAN1" /></a>           <a href="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWARE-Span-WAN2.png"><img src="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWARE-Span-WAN2.png" alt="VMWARE-Span-WAN2" /></a>             At this point Security onion was able to see what was going on.  In my case I allowed for visibility on both sides of my routing firewall, so there was a decent amount of data.     This is the interesting part, I think.  My initial thoughts are that this could be a &ldquo;network in a box&rdquo; for small offices.  No router, no servers (other than the VMware host), essentially a fully functional &ldquo;enterprise&rdquo; network of hosts, including a very high quality IDS device in a single device.  Put whatever firewall / vrouter in there that is supported or familiar, <a href="http://www.pfsense.org">pfsense</a>, <a href="http://www.juniper.net">Juniper vSRX</a>, <a href="http://www.fortinet.com">fortinet</a>, <a href="http://www.paloaltonetworks.com">Palo Alto</a>, they all have virtual devices and they all do a fine job [with the exception of IPv6; the only one I could get DHCPv6-PD to work with was pfsense.  Still need to test the fortinet]. Here is a high level diagram of how mine is put together. <a href="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWare-SPAN.jpg"><img src="http://www.forwardingplane.net/wp-content/uploads/2013/07/VMWare-SPAN.jpg" alt="VMWare SPAN" /></a> Is this a viable option?  I have no idea, but it does work pretty darned well.  In fact, ironically enough, the day I got this working (July 13, 2013), a post went up over at <a href="http://www.geekempire.com/2013/07/virtual-security-onion-via-ubuntu-kvm.html">GeekEmpire</a> doing almost exactly the same thing with KVM and OVS.  The setup is shockingly similar, right down to using pfSense. I was actually a bit envious, not only because his post went up first, but because he did what I had actually wanted to do by using KVM and OVS.  It&rsquo;s well done, I recommend reading it. I think this is a sign of what will come.  &ldquo;network in a box&rdquo; is an intriguing concept, and I&rsquo;m absolutely <a href="https://www.google.com/search?q=network+in+a+box&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:en-US:official&amp;client=firefox-a&amp;channel=fflb">positive I am not the only one thinking about it</a>.  I think, however, that the important part is to see the options available and make sure the masses know that there are many ways to do it.  It is not VMware or nothing, and it&rsquo;s certainly not cisco or the highway.  OpenSource tools like OVS and KVM under a free operating system like Linux can compete at the highest levels and there are documents and how-tos out there.  More importantly, it&rsquo;s not hard.  The same goes for security appliances and even vrouters.  Security Onion and pfSense are both viable platforms and they&rsquo;re just the tip of the iceberg.  At the end of the day it all comes down to options. Opensource, commercial, they all have virtualization strategies and the more you know the better off you&rsquo;ll be in the long run because virt is here to stay.</p>

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="https://forwardingplane.net/tags/lab-time">Lab Time</a></li>
                
                
                <li><a class="article-category-link" href="https://forwardingplane.net/tags/security">Security</a></li>
                
                
                <li><a class="article-category-link" href="https://forwardingplane.net/tags/virtualization">Virtualization</a></li>
                
            
        
    </ul>
  </li>
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "forwwardingplane" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="https://forwardingplane.net/post/building-flowvisor-on-centos-6-quick-and-dirty/"
                class="button big previous">Building FlowVisor on Centos 6 - quick and dirty</a></li>
    

    
        <li><a href="https://forwardingplane.net/post/the-sad-state-of-ipv6-and-why-you-need-to-learn-it/"
                class="button big next">The sad state of IPv6 and why you need to learn it.</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
    
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/packet-pushers-weekend-edition-no1/">Packet Pushers Weekend Edition Number 1</a>
              </h3>
              
              <time class="published" datetime='2019-11-02'>
                November 2, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/">Posts</a>
              </h3>
              
              <time class="published" datetime='2019-11-02'>
                November 2, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/elastiflow-template-vm/">ElastiFlow Template VM</a>
              </h3>
              
              <time class="published" datetime='2019-09-08'>
                September 8, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/basic-automation-for-wisps-and-small-to-medium-isps/">Basic automation for WISPs and small to medium ISPs</a>
              </h3>
              
              <time class="published" datetime='2019-07-29'>
                July 29, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://forwardingplane.net/post/the-bgp-conundrum/">The BGP conundrum</a>
              </h3>
              
              <time class="published" datetime='2019-06-30'>
                June 30, 2019
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            "/post/"
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  

  
  

  
  <section id="footer">
    
    <p class="copyright">
      
        Copyright (c) 2019, all rights reserved.
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js//highlight.min.js"></script>
        
        
        
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://forwardingplane.net/js/util.js"></script>
      <script src="https://forwardingplane.net/js/main.js"></script>
      <script src="https://forwardingplane.net/js/backToTop.js"></script>
    

    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

