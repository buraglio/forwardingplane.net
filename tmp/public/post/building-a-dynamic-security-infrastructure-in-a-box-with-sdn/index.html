<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8" />
<meta name="author" content="Nick Buraglio" />
<meta name="description" content="A wealth of run on sentences, misspelled words, and grammatical errors related to Routing, Switching, Security, Strategy…." />
<meta name="keywords" content="blog, tech" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.58.3" />

<link rel="canonical" href="https://forwardingplane.net/post/building-a-dynamic-security-infrastructure-in-a-box-with-sdn/">
<meta property="og:title" content="Building a dynamic security infrastructure [in a box - with SDN]" />
<meta property="og:description" content="Years ago I wrote about building a secure network in a box. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://forwardingplane.net/post/building-a-dynamic-security-infrastructure-in-a-box-with-sdn/" />
<meta property="article:published_time" content="2019-05-29T18:17:13+00:00" />
<meta property="article:modified_time" content="2019-05-29T18:17:13+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building a dynamic security infrastructure [in a box - with SDN]"/>
<meta name="twitter:description" content="Years ago I wrote about building a secure network in a box. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then."/>


<meta itemprop="name" content="Building a dynamic security infrastructure [in a box - with SDN]">
<meta itemprop="description" content="Years ago I wrote about building a secure network in a box. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then.">


<meta itemprop="datePublished" content="2019-05-29T18:17:13&#43;00:00" />
<meta itemprop="dateModified" content="2019-05-29T18:17:13&#43;00:00" />
<meta itemprop="wordCount" content="431">



<meta itemprop="keywords" content="Lab Time,OpenFlow,SDN,Security," />


<link rel="stylesheet" href="https://forwardingplane.net/css/layout.css" />


<link rel="stylesheet" href="https://forwardingplane.net/css/default-dark.css" />




<title>


     Building a dynamic security infrastructure [in a box - with SDN] 

</title>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="https://forwardingplane.net/">ForwardingPlane.net</a>
    </div> 

    
    
    <a class="nav-item" href="https://forwardingplane.net/post/"><div class="nav-item-title">Posts</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/tags/"><div class="nav-item-title">Tags</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/about"><div class="nav-item-title">about</div></a>
    
    <a class="nav-item" href="https://forwardingplane.net/configuration-archive"><div class="nav-item-title">configuration-archive</div></a>
    

  </nav>

  
<div class="social-links-header">

  
  <a href="mailto:my%20lastname%20at%20forwardingplane%20dot%20net"><div class="social-link">email</div></a>
  

  
  <a href="https://github.com/buraglio" target="_blank"><div class="social-link">gh</div></a>
  

  

  
  <a href="https://twitter.com/forwardingplane" target="_blank"><div class="social-link">twtr</div></a>
  

  
  <a href="https://www.linkedin.com/in/buraglio" target="_blank"><div class="social-link">in</div></a>
  

</div>


</div>


</header>


<article class="post">
    <h1 class="title"> Building a dynamic security infrastructure [in a box - with SDN] </h1>
    <div class="content"> <p>Years ago I wrote about building a <a href="https://www.forwardingplane.net/2013/07/building-a-secured-network-in-a-box/">secure network in a box</a>. Over a weekend I decided to revisit this concept thanks to a colleague at work wanting to do something similar. It got me thinking “a lot has changed since I last did this” and it felt like time to revisit it. Well, disappointment wasn’t in the cards because it’s easier, smarter, and more flexible now that it was back then. As I noted back in 2013 when I wrote that last post, OVS was a lot less well traveled and, frankly, there was not a reasonable controller that I could use in production for OpenFlow integration. I’ve since standardized on <a href="https://www.proxmox.com/en/">ProxMox</a> for my lab and production virtualization and have espoused on every available occasion the usefulness of the <a href="https://www.faucet.nz">Faucet SDN controller</a>. Both play fundamental roles in this project. This is significantly easier than I expected - primarily due to the use of faucet for controlling the OVS switch. It’s fairly straightforward, so I won’t go into the step by step details here since the projects have good install and support docs. Proxmox has support for OVS, so just install it using apt and create an OVS switch in the GUI interface. Faucet has <a href="https://docs.faucet.nz/en/latest/">amazingly complete documentation</a> and even a <a href="https://docs.faucet.nz/en/latest/installation.html#installing-on-raspberry-pi">raspberry pi image</a> (if you’re still thinking “OpenFlow is dead, isn’t it?”, have a listen to <a href="https://blog.ipspace.net/2019/04/using-faucet-to-build-sc18-network-with.html">this podcast</a> I did with Ivan Pepelnjak). From there, install a <a href="https://securityonion.net/">security option VM</a> (or any other tool you want to capture data with). Once you have the OVS switch, the controller, and the VM up and running getting data to it is as simple as issuing the comments to configure a controller. I my case the command was:```
sudo ovs-vsctl set-controller vmbr4 tcp:10.16.9.12:6653 tcp:10.16.9.12:6654</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-In my lab design the architecture was as such ![Faucet OVS Proxmox Security](https://www.forwardingplane.net/wp-content/uploads/2019/05/Faucet-OVS-Proxmox-Security.jpg "Faucet OVS Proxmox Security.jpg") The two switches on the right are physical and span all uplink data via two physical ports into my proxmox host. Everything else is done virtually in OVS. Once you have the controller setup, the data coming in, and the host listening, you can validate you have the correct controller, interfaces and ports in ovs.```" data-lang="In my lab design the architecture was as such ![Faucet OVS Proxmox Security](https://www.forwardingplane.net/wp-content/uploads/2019/05/Faucet-OVS-Proxmox-Security.jpg "Faucet OVS Proxmox Security.jpg") The two switches on the right are physical and span all uplink data via two physical ports into my proxmox host. Everything else is done virtually in OVS. Once you have the controller setup, the data coming in, and the host listening, you can validate you have the correct controller, interfaces and ports in ovs.```">root@pve1:~# ovs-vsctl show
75b4bc7f-4e00-45c2-8919-b043cbaf509d
Bridge &#34;vmbr4&#34;
Controller &#34;tcp:10.16.9.12:6654&#34;
Controller &#34;tcp:10.16.9.12:6653&#34;
is\_connected: true
Port &#34;enx00051ba65ece&#34;
Interface &#34;enx00051ba65ece&#34;
Port &#34;tap115i1&#34;
Interface &#34;tap115i1&#34;
Port &#34;vmbr4&#34;
Interface &#34;vmbr4&#34;
type: internal
Port &#34;eno2&#34;
Interface &#34;eno2&#34;
ovs\_version: “2.7.0&#34;</code></pre></div>
<p>Listing interfaces in OVS can be a helpful way to aid in building the faucet configuration```
root@pve1:~# ovs-vsctl &ndash;columns=ofport,name list interface
ofport : 65534
name : &ldquo;vmbr4&rdquo;</p>

<p>ofport              : 1
name : &ldquo;eno2&rdquo;</p>

<p>ofport              : 4
name : &ldquo;tap115i1&rdquo;</p>

<p>ofport              : 2
name : &ldquo;enx00051ba65ece&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-For spanning the data into the VM, the basic configuration within faucet looks like this and should reside in /etc/faucet/faucet.yaml. The real meat here is the mirror statement on port 4.```" data-lang="For spanning the data into the VM, the basic configuration within faucet looks like this and should reside in /etc/faucet/faucet.yaml. The real meat here is the mirror statement on port 4.```">dps:
    proxovs1:
        dp\_id: 0x51ba65ece
        hardware: &#34;Open vSwitch&#34;
        interfaces:
            65534:
                name: &#34;vmbr4&#34;
                description: &#34;ProxMox OVS vmbr4&#34;
                native\_vlan: servernet
            1:
                name: &#34;eno2&#34;
                description: &#34;Span from sw1&#34;
                native\_vlan: servernet
            2:
                name: &#34;enx00051ba65ece&#34;
                description: &#34;Span from sw2&#34;
                native\_vlan: servernet
            4:
                name: &#34;tap115i1&#34;
                description: &#34;ProxMox OVS vmbr4&#34;
                output\_only: True
                mirror: \[1,2\]</code></pre></div>
<p>This can be fairly easily adjusted to mirror all internal, east-west traffic in a virtualization farm.</p>
 </div>
    <footer class="post-footer">

  <div class="post-footer-data">
    
<div class="tags">
    
      <div class="tag">
        <a href="https://forwardingplane.net/tags/lab-time">#Lab Time</a>
      </div>
    
      <div class="tag">
        <a href="https://forwardingplane.net/tags/openflow">#OpenFlow</a>
      </div>
    
      <div class="tag">
        <a href="https://forwardingplane.net/tags/sdn">#SDN</a>
      </div>
    
      <div class="tag">
        <a href="https://forwardingplane.net/tags/security">#Security</a>
      </div>
    
</div>

    <div class="date"> 29 May 2019 </div>
  </div>

</footer>


  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "forwwardingplane" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</article>

  <footer>

  <div class="social-links-footer">

  
  <a href="mailto:my%20lastname%20at%20forwardingplane%20dot%20net"><div class="social-link">Email</div></a>
  

  
  <a href="https://github.com/buraglio" target="_blank"><div class="social-link">GitHub</div></a>
  

  

  
  <a href="https://twitter.com/forwardingplane" target="_blank"><div class="social-link">Twitter</div></a>
  

  
  <a href="https://www.linkedin.com/in/buraglio" target="_blank"><div class="social-link">LinkedIn</div></a>
  

  <div class="social-link">
  <a href="https://forwardingplane.net/index.xml" target="_blank">RSS</a>
  </div>

</div>


  <div class="copyright"> Copyright (c) 2019, all rights reserved. </div>

  <div class="poweredby">
    Powered by <a href="https://gohugo.io/">Hugo</a>.
  </div>

  </footer>

</div> 

</body>
</html>

